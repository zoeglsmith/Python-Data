<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:47:55 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-1276] Content-Encoding treated as a charset by HTTPConduit.WrappedOutputStream.handleResponse</title>
                <link>https://issues.apache.org/jira/browse/CXF-1276</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;HTTPConduit.WrappedOutputStream.handleResponse (HTTPConduit.java, around line 1920):&lt;br/&gt;
---------&lt;br/&gt;
String enc = connection.getContentEncoding();&lt;br/&gt;
if (enc == null&lt;br/&gt;
    &amp;amp;&amp;amp; ct != null&lt;br/&gt;
    &amp;amp;&amp;amp; ct.indexOf(&quot;charset&quot;) != -1) {&lt;br/&gt;
    enc = ct.substring(ct.indexOf(&quot;charset&quot;) + 8);&lt;br/&gt;
    if (enc.indexOf(&quot;;&quot;) != -1) &lt;/p&gt;
{
        enc = enc.substring(0, enc.indexOf(&quot;;&quot;));
    }
&lt;p&gt;}&lt;br/&gt;
inMessage.put(Message.ENCODING, HttpHeaderHelper.mapCharset(enc));&lt;br/&gt;
---------&lt;/p&gt;

&lt;p&gt;When the HTTP response has a valid Content-Encoding header (e.g. &quot;Content-Encoding: gzip&quot;), this fails as it tries to treat &quot;gzip&quot; as a charset name.  On 2.0.3 I get:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
        at java.util.concurrent.ConcurrentHashMap.put(ConcurrentHashMap.java:846)&lt;br/&gt;
        at org.apache.cxf.helpers.HttpHeaderHelper.mapCharset(HttpHeaderHelper.java:82)&lt;/p&gt;

&lt;p&gt;This has been fixed (&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-1227&quot; title=&quot;NPE in HttpHeaderHelper.mapCharset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-1227&quot;&gt;&lt;del&gt;CXF-1227&lt;/del&gt;&lt;/a&gt;) in the latest 2.0.4 snapshot and in that I get:&lt;/p&gt;

&lt;p&gt;java.io.IOException: Invalid character set gzip in request.&lt;br/&gt;
        at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:1936)&lt;/p&gt;

&lt;p&gt;I haven&apos;t tried it in the 2.1 snapshot but the trunk version of HTTPConduit has the same code as the 2.0.4 branch.&lt;/p&gt;

&lt;p&gt;Replacing String enc = connection.getContentEncoding(); with String enc = null; is enough to make it work but I don&apos;t know if there&apos;s a better way to fix it.&lt;/p&gt;

&lt;p&gt;The background to this is that I&apos;m working with a web service that does GZIP compression and I&apos;ve written a pair of interceptors to GZIP the request stream and unzip the response, based on the code in samples/configuration_interceptor but doing the Content-Encoding headers properly (i.e. adding one to the request, and checking for one in the response before unzipping).  I&apos;m more than happy to contribute these to CXF but they currently only work with the fix I described above.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12384312">CXF-1276</key>
            <summary>Content-Encoding treated as a charset by HTTPConduit.WrappedOutputStream.handleResponse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="button_boxer">Ian Roberts</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Dec 2007 13:16:11 +0000</created>
                <updated>Tue, 29 Jan 2008 21:51:57 +0000</updated>
                            <resolved>Mon, 7 Jan 2008 16:09:13 +0000</resolved>
                                    <version>2.0.3</version>
                    <version>2.0.4</version>
                                    <fixVersion>2.0.4</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12556607" author="dkulp" created="Mon, 7 Jan 2008 16:09:13 +0000"  >
&lt;p&gt;I think this is now resolved on trunk.  I&apos;ll merge it to 2.0.4 shortly.&lt;/p&gt;
</comment>
                            <comment id="12556638" author="button_boxer" created="Mon, 7 Jan 2008 17:51:27 +0000"  >&lt;p&gt;I&apos;ve looked at your change on the trunk and I don&apos;t think it&apos;ll fix it for me.  The fix in rev 609658 means that it will now try and parse a charset out of the content-type first.  However if there is no charset in the content-type (which there isn&apos;t in my case, using MTOM) it still tries to use connection.getContentEncoding(), which will never be a valid charset - it&apos;s either null or something like &quot;gzip&quot; or &quot;deflate&quot;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>112094</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i143kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>