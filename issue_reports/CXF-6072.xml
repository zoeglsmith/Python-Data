<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:48:38 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6072] jaxrs securityContext.getUserPrincipal is broken if login is done during the request</title>
                <link>https://issues.apache.org/jira/browse/CXF-6072</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;tested on last 2.6 release and didn&apos;t take time to check on 3. but I guess it is the same:&lt;/p&gt;

&lt;p&gt;I call a rest endpoint, in my business I login(user, pass) from the request (http) then from the security context I get the principal -&amp;gt; null, if I get it fro mthe request it is avlued. It is cause org.apache.cxf.transport.http.AbstractHTTPDestination#setupMessage(org.apache.cxf.message.Message, javax.servlet.ServletConfig, javax.servlet.ServletContext, javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse) stores the principal for the request but it evaluates it too early.&lt;/p&gt;

&lt;p&gt;Why not keeping the delegation to the http request?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12751448">CXF-6072</key>
            <summary>jaxrs securityContext.getUserPrincipal is broken if login is done during the request</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="romain.manni-bucau">Romain Manni-Bucau</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Oct 2014 18:14:03 +0000</created>
                <updated>Mon, 16 Feb 2015 16:09:10 +0000</updated>
                            <resolved>Thu, 30 Oct 2014 13:09:07 +0000</resolved>
                                                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>2.7.14</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14189852" author="sergey_beryozkin" created="Thu, 30 Oct 2014 09:36:55 +0000"  >&lt;p&gt;Hi Romain&lt;/p&gt;

&lt;p&gt;If the evaluation is done in the CXF chain then it is simply a matter of resetting a security context on the message, can you do it instead ?&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="14189917" author="romain.manni-bucau" created="Thu, 30 Oct 2014 10:42:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergeyb&quot; class=&quot;user-hover&quot; rel=&quot;sergeyb&quot;&gt;sergeyb&lt;/a&gt; Hi Sergey, not sure I get what you mean? as a user I shouldn&apos;t have to do it at all, isn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="14189948" author="sergey_beryozkin" created="Thu, 30 Oct 2014 11:26:31 +0000"  >&lt;p&gt;Sure, can you please prototype some code here showing what you do now ?&lt;/p&gt;</comment>
                            <comment id="14189994" author="sergey_beryozkin" created="Thu, 30 Oct 2014 12:30:35 +0000"  >&lt;p&gt;Actually, I think you are right, AbstractHttpDestination does delegate to the request to check the roles a given principal is in but does not to get the actual Principal, it is just not clear to me why it makes a difference in your case, typilcally, if a servlet-based security is enforced, then Principal would already be set up, I guess it is something specific to the way it is integrated into TomEE...&lt;br/&gt;
Either way, delegating to the request is indeed the right fix IMHO  &lt;/p&gt;</comment>
                            <comment id="14190025" author="sergey_beryozkin" created="Thu, 30 Oct 2014 13:05:23 +0000"  >&lt;p&gt;See this commit:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/cxf/commit/83ca30fd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/cxf/commit/83ca30fd&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Dan - let me know please if you see some issues with it&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="14190041" author="romain.manni-bucau" created="Thu, 30 Oct 2014 13:21:19 +0000"  >&lt;p&gt;There is no link with tomee, I can reproduce it with a plain tomcat &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Just do::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;secu&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SecurityResource {
  @Context HttpServletRequest req;
  @Context SecurityContext secu;

  @POST &lt;span class=&quot;code-comment&quot;&gt;// @FormParam etc as needed, skip &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; readability
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; login(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; user, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pwd) {
     req.login(user, pwd);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; secu.getPrincipal().getName();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fix seems right, thank you!&lt;/p&gt;</comment>
                            <comment id="14190048" author="sergey_beryozkin" created="Thu, 30 Oct 2014 13:25:36 +0000"  >&lt;p&gt;Cool, I did not even know HttpServletRequest.login(name, password) method existed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21qaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>