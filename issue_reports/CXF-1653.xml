<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:47:18 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-1653] Deviation from spec: unnecessary check for @ProduceMime of sub-resource locators</title>
                <link>https://issues.apache.org/jira/browse/CXF-1653</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;m experimenting with restful services, and stumbled upon something that seems to be a deviation from the specification in CXF&apos;s implementation of jax-rs: when matching a request to resource methods, CXF tries to match the @ProduceMime value of sub-resource locators with the request&apos;s Accept header. See the second condition in the first line of the below code snippet from JAXRSUtils.findTargetMethod():&lt;/p&gt;

&lt;p&gt;if (ori.isSubResourceLocator() &amp;amp;&amp;amp; matchMimeTypes(requestType, acceptType, ori)) {&lt;br/&gt;
	candidateList.put(ori, map);&lt;br/&gt;
} else if (ori.getHttpMethod().equalsIgnoreCase(httpMethod)&lt;br/&gt;
		   &amp;amp;&amp;amp; matchMimeTypes(requestType, acceptType, ori)) {&lt;/p&gt;

&lt;p&gt;The call to matchMimeTypes() in the first condition is problematic for two reasons:&lt;br/&gt;
  1. (in my understanding) according to the specification, sub-resource locators never has to be filtered by media types. See spec v0.6 (&lt;a href=&quot;https://jsr311.dev.java.net/drafts/spec20080131.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jsr311.dev.java.net/drafts/spec20080131.pdf&lt;/a&gt;) section 2.5: step 2.(d) applies to sub-resource locators, and filters them only by URI template matching. Then the 4th point of step 3.(a) filters methods by matching their @ProduceMime values with the request&apos;s Accept header, but at this step we only have resource methods at hand, and no sub-resource locators at all.&lt;br/&gt;
  2. This code introduces a bug by which an NPE will be thrown in the else branch of the above code snippet, when ori is a sub-resource locator, and the if condition in the first line evaluates to false due to mismatching mime-types. In this case ori.getHttpMethod() still returns null, thus ori.getHttpMethod().equalsIgnoreCase(httpMethod) throws an NPE when evaluating the second if. This happens if the first media type in the request&apos;s Accept header doesn&apos;t match with the @ProduceMime value of the sub-resource locator. (see the attached test-case showing this bug).&lt;/p&gt;

&lt;p&gt;Basically, it doesn&apos;t make any sense to annotate a sub-resource locator with @ProduceMime, as it doesn&apos;t produce any content, just relays the request to another resource class. The specification confirms this when stating (section 2.4 in spec v0.6): &quot;Application classes can declare the supported request and response media types using the @ProduceMime and @ConsumeMime annotations. These annotations MAY be applied to a resource method, a resource class, or to an entity provider...&quot; The mentioned three things don&apos;t include sub-resource locators according to the terminology in section 1.5.&lt;/p&gt;

&lt;p&gt;Ok, sorry for the longish description, I just wanted to propose the attached patch removing the matchMimeTypes() call from the first line above.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Balazs&lt;/p&gt;</description>
                <environment></environment>
        <key id="12398431">CXF-1653</key>
            <summary>Deviation from spec: unnecessary check for @ProduceMime of sub-resource locators</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="zagyvaib">Zagyvai Balazs</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jun 2008 14:23:45 +0000</created>
                <updated>Mon, 18 Aug 2008 18:26:25 +0000</updated>
                            <resolved>Thu, 3 Jul 2008 17:17:26 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.1.2</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12605615" author="zagyvaib" created="Tue, 17 Jun 2008 14:24:44 +0000"  >&lt;p&gt;test case for the bug&lt;/p&gt;</comment>
                            <comment id="12605616" author="zagyvaib" created="Tue, 17 Jun 2008 14:26:06 +0000"  >&lt;p&gt;proposed patch&lt;/p&gt;</comment>
                            <comment id="12605662" author="sergey_beryozkin" created="Tue, 17 Jun 2008 17:12:25 +0000"  >&lt;p&gt;Thanks for the patch. I&apos;ll need to confirm it on the jax-rs users list to be 100% sure.&lt;br/&gt;
I think you&apos;re absolutely right&lt;/p&gt;</comment>
                            <comment id="12610286" author="sergey_beryozkin" created="Thu, 3 Jul 2008 17:17:15 +0000"  >&lt;p&gt;Done on the trunk, thanks for the patch. Please reopen if you do need it applied to 2.1 as well&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12384134" name="JAXRSUtils.patch" size="172" author="zagyvaib" created="Tue, 17 Jun 2008 14:26:06 +0000"/>
                            <attachment id="12384133" name="test.zip" size="1369" author="zagyvaib" created="Tue, 17 Jun 2008 14:24:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>112441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1acqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>268531</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>