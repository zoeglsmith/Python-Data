<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:43:38 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7905] JAXBUtils fails to setEscapeHandler due to null escapeHandler</title>
                <link>https://issues.apache.org/jira/browse/CXF-7905</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I am having the following issue with a SOAP request of my software deployed in Wildfly&#160;13.0.0.Final. Wildfly makes use of CXF core in version 3.2.4-jbossorg-1. Of this version I was unable to find sources but my issue persists with any or the 3.2 versions of CXF.&lt;/p&gt;

&lt;p&gt;The same software was previously deployed without any issues on Wildfly 10.0.1.Final which uses CXF 3.1.6.&lt;/p&gt;

&lt;p&gt;Upon authentification at a SOAP web service I now receive the following exception:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
12:26:29,314 WARNING [org.apache.cxf.phase.PhaseInterceptorChain] (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; task-1) Interceptor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {http:&lt;span class=&quot;code-comment&quot;&gt;//endpoint.soap.webservice.logicaldoc.com/}SoapAuthServiceService#{http://ws.logicaldoc.com}login has thrown exception, unwinding now: java.lang.NullPointerException
&lt;/span&gt;	at com.sun.xml.bind.v2.runtime.MarshallerImpl.setProperty(MarshallerImpl.java:518)
	at org.apache.cxf.common.jaxb.JAXBUtils.setEscapeHandler(JAXBUtils.java:1567)
	at org.apache.cxf.jaxb.io.DataWriterImpl.lambda$createMarshaller$0(DataWriterImpl.java:138)
	at org.apache.cxf.jaxb.JAXBDataBinding.applyEscapeHandler(JAXBDataBinding.java:271)
	at org.apache.cxf.jaxb.io.DataWriterImpl.createMarshaller(DataWriterImpl.java:138)
	at org.apache.cxf.jaxb.io.DataWriterImpl.write(DataWriterImpl.java:239)
	at 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;jaxb MarschallerImpl fails when org.apache.cxf.common.jaxb.JAXBUtils tries to set an EscapeHandler of null.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Possible Solution&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;Adding a null check at&#160;org.apache.cxf.common.jaxb.JAXBUtils.setEscapeHandler as indicated below, solves the issue.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void setEscapeHandler(Marshaller marshaller, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; escapeHandler) { 
     &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { 
          &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; postFix = getPostfix(marshaller.getClass()); 
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (postFix != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; escapeHandler != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { 
             marshaller.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.sun.xml&quot;&lt;/span&gt; + postFix + &lt;span class=&quot;code-quote&quot;&gt;&quot;.bind.characterEscapeHandler&quot;&lt;/span&gt;, escapeHandler); 
          } 
     } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (PropertyException e) { 
          LOG.log(Level.INFO, &lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to set MinumEscapeHandler to jaxb marshaller&quot;&lt;/span&gt;, e); 
     } 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;While a PropertyException seems to be okay for CXF a null escapeHandler Object leads to&#160;escapeHandler.getClass().getName() called by jaxb MarshallerImpl just as it was trying to throw a&#160;PropertyException.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Why is the EscapeHandler null&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;A null EscapeHandler can occur when&#160;org.apache.cxf.common.jaxb.createEscapeHandler()&apos;s actual return delegate ProxyHelper.getProxy() throws an Exception.&lt;/p&gt;

&lt;p&gt;In my case a the following Exception is thrown:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; org.apache.cxf.endpoint.Client is not visible from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;loader at java.lang.reflect.Proxy$ProxyClassFactory.apply(Proxy.java:581) at java.lang.reflect.Proxy$ProxyClassFactory.apply(Proxy.java:557) at java.lang.reflect.WeakCache$Factory.get(WeakCache.java:230) at java.lang.reflect.WeakCache.get(WeakCache.java:127) at java.lang.reflect.Proxy.getProxyClass0(Proxy.java:419) at java.lang.reflect.Proxy.newProxyInstance(Proxy.java:719) at org.apache.cxf.common.util.ProxyHelper.getProxyInternal(ProxyHelper.java:49) at org.apache.cxf.common.util.ProxyHelper.getProxy(ProxyHelper.java:126) at org.apache.cxf.frontend.ClientProxyFactoryBean.create(ClientProxyFactoryBean.java:176) at org.apache.cxf.jaxws.JaxWsProxyFactoryBean.create(JaxWsProxyFactoryBean.java:142) at org.apache.cxf.jaxws.ServiceImpl.createPort(ServiceImpl.java:493) at org.jboss.wsf.stack.cxf.client.ProviderImpl$JBossWSServiceImpl.createPort(ProviderImpl.java:580) at org.apache.cxf.jaxws.ServiceImpl.getPort(ServiceImpl.java:359) at org.apache.cxf.jaxws.ServiceImpl.getPort(ServiceImpl.java:350) at javax.xml.ws.Service.getPort(Service.java:99) at com.logicaldoc.webservice.soap.endpoint.SoapAuthServiceService.getSoapAuthServicePort(SoapAuthServiceService.java:68)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;org.apache.cxf.endpoint.Client does not seem to be visible of the combined classloader constructed in&#160;ProxyHelper.getProxyInternal().&lt;/p&gt;

&lt;p&gt;I am not utterly familiar with ClassLoaders but I find it strange that&#160;org.apache.cxf classes - which are calling a ProxyHelper which constructs a ClassLoader for &quot;com.sun.xml.bind.marshaller.CharacterEscapeHandler&quot; - fail because another&#160;org.apache.cxf interface is not visible.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13200230">CXF-7905</key>
            <summary>JAXBUtils fails to setEscapeHandler due to null escapeHandler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="thorsten.hersam">Thorsten Hersam</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Nov 2018 11:40:04 +0000</created>
                <updated>Mon, 25 Mar 2019 12:28:21 +0000</updated>
                            <resolved>Tue, 27 Nov 2018 03:51:07 +0000</resolved>
                                    <version>3.2</version>
                                    <fixVersion>3.2.8</fixVersion>
                    <fixVersion>3.3.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16697139" author="thorsten.hersam" created="Fri, 23 Nov 2018 13:34:06 +0000"  >&lt;p&gt;The error occurs with all 3.2.x versions of CXF.&lt;/p&gt;</comment>
                            <comment id="16699885" author="ffang" created="Tue, 27 Nov 2018 03:42:03 +0000"  >&lt;p&gt;I ran into similar issue like &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; com.sun.xml.bind.marshaller.CharacterEscapeHandler is not visible from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;loader

	at java.lang.reflect.Proxy$ProxyClassFactory.apply(Proxy.java:581)

	at java.lang.reflect.Proxy$ProxyClassFactory.apply(Proxy.java:557)

	at java.lang.reflect.WeakCache$Factory.get(WeakCache.java:230)

	at java.lang.reflect.WeakCache.get(WeakCache.java:127)

	at java.lang.reflect.Proxy.getProxyClass0(Proxy.java:419)

	at java.lang.reflect.Proxy.newProxyInstance(Proxy.java:719)

	at org.apache.cxf.common.util.ProxyHelper.getProxyInternal(ProxyHelper.java:49)

	at org.apache.cxf.common.util.ProxyHelper.getProxy(ProxyHelper.java:126)

	at org.apache.cxf.common.jaxb.JAXBUtils.createEscapeHandler(JAXBUtils.java:1597)

	at org.apache.cxf.common.jaxb.JAXBUtils.createMininumEscapeHandler(JAXBUtils.java:1575)

	at org.apache.cxf.jaxb.JAXBDataBinding.setContext(JAXBDataBinding.java:257)

	at org.apache.cxf.jaxb.JAXBDataBinding.initialize(JAXBDataBinding.java:361)

	at org.apache.cxf.service.factory.AbstractServiceFactoryBean.initializeDataBindings(AbstractServiceFactoryBean.java:86)

	at org.apache.cxf.wsdl.service.factory.ReflectionServiceFactoryBean.buildServiceFromClass(ReflectionServiceFactoryBean.java:470)

	at org.apache.cxf.jaxws.support.JaxWsServiceFactoryBean.buildServiceFromClass(JaxWsServiceFactoryBean.java:695)

	at org.apache.cxf.wsdl.service.factory.ReflectionServiceFactoryBean.initializeServiceModel(ReflectionServiceFactoryBean.java:530)

	at org.apache.cxf.wsdl.service.factory.ReflectionServiceFactoryBean.create(ReflectionServiceFactoryBean.java:263)

	at org.apache.cxf.jaxws.support.JaxWsServiceFactoryBean.create(JaxWsServiceFactoryBean.java:199)

	at org.apache.cxf.frontend.AbstractWSDLBasedEndpointFactory.createEndpoint(AbstractWSDLBasedEndpointFactory.java:103)

	at org.apache.cxf.frontend.ServerFactoryBean.create(ServerFactoryBean.java:168)

	at org.apache.cxf.jaxws.JaxWsServerFactoryBean.create(JaxWsServerFactoryBean.java:211)

	at org.apache.cxf.jaxws.EndpointImpl.getServer(EndpointImpl.java:460)

	at org.apache.cxf.jaxws.EndpointImpl.doPublish(EndpointImpl.java:338)

	at org.apache.cxf.jaxws.EndpointImpl.publish(EndpointImpl.java:255)

	at org.apache.cxf.jaxws.EndpointImpl.publish(EndpointImpl.java:543)

	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)

	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)

	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)

	at java.lang.reflect.Method.invoke(Method.java:498)

	at org.apache.aries.blueprint.utils.ReflectionUtils.invoke(ReflectionUtils.java:331)

	at org.apache.aries.blueprint.container.BeanRecipe.invoke(BeanRecipe.java:838)

	at org.apache.aries.blueprint.container.BeanRecipe.runBeanProcInit(BeanRecipe.java:591)

	at org.apache.aries.blueprint.container.BeanRecipe.internalCreate2(BeanRecipe.java:703)

	at org.apache.aries.blueprint.container.BeanRecipe.internalCreate(BeanRecipe.java:666)

	at org.apache.aries.blueprint.di.AbstractRecipe$1.call(AbstractRecipe.java:81)

	at java.util.concurrent.FutureTask.run(FutureTask.java:266)

	at org.apache.aries.blueprint.di.AbstractRecipe.create(AbstractRecipe.java:90)

	at org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:360)

	at org.apache.aries.blueprint.container.BlueprintRepository.createAll(BlueprintRepository.java:190)

	at org.apache.aries.blueprint.container.BlueprintContainerImpl.instantiateEagerComponents(BlueprintContainerImpl.java:716)

	at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:413)

	at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:278)

	at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:299)

	at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:268)

	at org.apache.aries.blueprint.container.BlueprintExtender.createContainer(BlueprintExtender.java:264)

	at org.apache.aries.blueprint.container.BlueprintExtender.modifiedBundle(BlueprintExtender.java:254)

	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:500)

	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:433)

	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$AbstractTracked.track(BundleHookBundleTracker.java:725)

	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.bundleChanged(BundleHookBundleTracker.java:463)

	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$BundleEventHook.event(BundleHookBundleTracker.java:422)

	at org.apache.felix.framework.util.SecureAction.invokeBundleEventHook(SecureAction.java:1179)

	at org.apache.felix.framework.EventDispatcher.createWhitelistFromHooks(EventDispatcher.java:730)

	at org.apache.felix.framework.EventDispatcher.fireBundleEvent(EventDispatcher.java:485)

	at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4579)

	at org.apache.felix.framework.Felix.startBundle(Felix.java:2174)

	at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:998)

	at org.apache.karaf.bundle.command.Restart.doExecute(Restart.java:51)

	at org.apache.karaf.bundle.command.BundlesCommand.execute(BundlesCommand.java:56)

	at org.apache.karaf.shell.impl.action.command.ActionCommand.execute(ActionCommand.java:84)

	at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:68)

	at org.apache.karaf.shell.impl.console.osgi.secured.SecuredCommand.execute(SecuredCommand.java:86)

	at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:571)

	at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:497)

	at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:386)

	at org.apache.felix.gogo.runtime.Pipe.doCall(Pipe.java:417)

	at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:229)

	at org.apache.felix.gogo.runtime.Pipe.call(Pipe.java:59)

	at java.util.concurrent.FutureTask.run(FutureTask.java:266)

	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)

	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)

	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When having multiple jaxb-impl bundle versions inside Karaf container.&lt;/p&gt;

&lt;p&gt;I think the problem you saw in JBoss EAP is similar, somehow you have multiple modules/jars both contains interface org.apache.cxf.endpoint.Client , however they are loaded by different clasloaders. You should resolve it in your container.&lt;/p&gt;

&lt;p&gt;Anyway, add a NPE guard in CXF is what we can do best inside CXF. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00sz4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>