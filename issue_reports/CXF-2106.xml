<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:47:43 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2106] Temp files created for data over 64kb are never deleted</title>
                <link>https://issues.apache.org/jira/browse/CXF-2106</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;CXF saves incoming data greater than 64kb are saved to a temp directory in a &lt;a href=&quot;http://svn.apache.org/viewvc/cxf/trunk/api/src/main/java/org/apache/cxf/io/CachedOutputStream.java?view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cached output stream&lt;/a&gt;. This makes sense since we don&apos;t want large messages to cause the JVM to run out of memory.&lt;br/&gt;
The problem is, these never seem to be deleted at the moment. You can see this if you run the mtom sample. You can change the directory that the temp file is written to using the org.apache.cxf.io.CachedOutputStream.OutputDirectory property. Notice with the mtom sample that two files are written to the directory for the client and server. This is because the the client invokes twice, once with a byte array and once with a data handler.&lt;/p&gt;

&lt;p&gt;If you know the size of all messages that may be received you can avoid this problem by setting the threshold for creating a temp file to be larger than the largest expected file. The property for this (measure in bytes) is org.apache.cxf.io.CachedOutputStream.Threshold.&lt;/p&gt;

&lt;p&gt;In my investigation it seems that there are two possible problems here. The first is that for the byte array the output stream is locked for future use, but not closed. So, when we try to delete the file a stream is still in use and the file cannot be deleted. If you close the stream when marking it as locked this problem seems to go away, although I haven&apos;t fully tested this, so I am unsure of the knock on affects :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/**
* Locks the output stream to prevent additional writes, but maintains
* a pointer to it so an InputStream can be obtained
* @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
*/
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void lockOutputStream() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    currentStream.flush();
    outputLocked = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    &lt;span class=&quot;code-comment&quot;&gt;// Not sure of the impact of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; close - mtom sample still works fine.
&lt;/span&gt;    currentStream.close();
    streamList.remove(currentStream);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However for the datahandler it seems that there is never any attempt to delete the file. It seems that the datahandler has no knowledge of the temp file and even if I try to close the inputstream it is using from the mtom client mainline I still see the temp file is never deleted.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tested against 2.1 branch and the trunk&lt;/p&gt;</environment>
        <key id="12416674">CXF-2106</key>
            <summary>Temp files created for data over 64kb are never deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="martinmurphy">Martin Murphy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Mar 2009 19:03:34 +0000</created>
                <updated>Fri, 24 Apr 2009 21:17:09 +0000</updated>
                            <resolved>Thu, 12 Mar 2009 13:32:20 +0000</resolved>
                                    <version>2.1.4</version>
                    <version>2.2</version>
                                    <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.5</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12681148" author="dkulp" created="Thu, 12 Mar 2009 03:08:38 +0000"  >
&lt;p&gt;I committed what I hope is a fix for this.  However, I don&apos;t have a windows box to try it.   On Linux, the files delete fine.   It seems to be a Windows issue.&lt;/p&gt;

&lt;p&gt;Could you try and double check it&apos;s fixed?&lt;/p&gt;</comment>
                            <comment id="12681273" author="martinmurphy" created="Thu, 12 Mar 2009 11:40:34 +0000"  >&lt;p&gt;Thanks for that Dan, just tried the version on the trunk and it only seems to work for the byte array. The temp file for the DataHandler still exists. I&apos;m looking into that now.&lt;/p&gt;</comment>
                            <comment id="12681302" author="dkulp" created="Thu, 12 Mar 2009 13:12:56 +0000"  >&lt;p&gt;&lt;br/&gt;
That&apos;s a bug in the demo.   Just committed a fix for that.   The demo wasn&apos;t closing the stream so it wasn&apos;t letting us know to delete the file.&lt;/p&gt;</comment>
                            <comment id="12682298" author="utuba" created="Mon, 16 Mar 2009 12:20:08 +0000"  >&lt;p&gt;This has fixed the issue for us on Windows 2008 Server.  Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12415071">CXF-2049</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sy7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>167020</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>