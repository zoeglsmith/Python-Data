<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:46:08 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3946] &lt;property name=&quot;namespacePrefixes&quot; ref=&quot;namespaceMap&quot; /&gt; causes exception due to immutable Map being used in JAXBElementProvider</title>
                <link>https://issues.apache.org/jira/browse/CXF-3946</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt; I was trying to set a specific namespace prefix for a qualified REST xml.&lt;/p&gt;

&lt;p&gt;I configured beans.xml and included package-info.java as below:&lt;/p&gt;

&lt;p&gt;@javax.xml.bind.annotation.XmlSchema(    namespace=GoldenKey.NS,&lt;br/&gt;
                                        elementFormDefault = javax.xml.bind.annotation.XmlNsForm.QUALIFIED,&lt;br/&gt;
                                        attributeFormDefault = javax.xml.bind.annotation.XmlNsForm.QUALIFIED,&lt;br/&gt;
                                        xmlns=&lt;/p&gt;
{@javax.xml.bind.annotation.XmlNs(prefix = GoldenKey.NS_QUALIFIER , namespaceURI=GoldenKey.NS)}
&lt;p&gt;                                     )&lt;/p&gt;

&lt;p&gt;package com.upmc.tdc.xml;&lt;/p&gt;


&lt;p&gt;beans.xml snippets:&lt;/p&gt;

&lt;p&gt;     &amp;lt;jaxrs:server id=&quot;goldenKey_rest&quot; address=&quot;/rest&quot;&amp;gt;&lt;br/&gt;
       &amp;lt;jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
         &amp;lt;ref bean=&quot;goldenKey_bean&quot; /&amp;gt;&lt;br/&gt;
       &amp;lt;/jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
        &amp;lt;jaxrs:extensionMappings&amp;gt;&lt;br/&gt;
            &amp;lt;entry key=&quot;json&quot; value=&quot;application/json&quot; /&amp;gt;&lt;br/&gt;
            &amp;lt;entry key=&quot;xml&quot; value=&quot;application/xml&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;/jaxrs:extensionMappings&amp;gt;&lt;br/&gt;
         &amp;lt;jaxrs:providers&amp;gt;&lt;br/&gt;
          &amp;lt;ref bean=&quot;dateProvider&quot; /&amp;gt;&lt;br/&gt;
          &amp;lt;ref bean=&quot;exceptionMapper&quot; /&amp;gt;&lt;br/&gt;
          &amp;lt;ref bean=&quot;jaxbProvider&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;/jaxrs:providers&amp;gt;&lt;br/&gt;
     &amp;lt;/jaxrs:server&amp;gt;&lt;/p&gt;

&lt;p&gt;     &amp;lt;jaxws:endpoint serviceName=&quot;GoldenKey&quot; endpointName=&quot;GoldenKeyPort&quot; id=&quot;goldenKey_soap&quot; implementor=&quot;#goldenKey_bean&quot; address=&quot;/soap&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;jaxws:binding&amp;gt;&lt;br/&gt;
            &amp;lt;soap:soapBinding version=&quot;1.2&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;/jaxws:binding&amp;gt;&lt;br/&gt;
        &amp;lt;jaxws:features&amp;gt;&lt;br/&gt;
            &amp;lt;bean class=&quot;org.apache.cxf.feature.LoggingFeature&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;prettyLogging&quot; value=&quot;true&quot; /&amp;gt;&lt;br/&gt;
            &amp;lt;/bean&amp;gt;&lt;br/&gt;
        &amp;lt;/jaxws:features&amp;gt;&lt;br/&gt;
    &amp;lt;/jaxws:endpoint&amp;gt;&lt;/p&gt;

&lt;p&gt;     &amp;lt;bean id=&quot;goldenKey_bean&quot; class=&quot;com.upmc.tdc.server.GoldenKeyImpl&quot;/&amp;gt;&lt;br/&gt;
     &amp;lt;bean id=&quot;dateProvider&quot; class=&quot;com.upmc.tdc.server.parameterhandler.DateParameterHandler&quot;/&amp;gt;&lt;br/&gt;
     &amp;lt;bean id=&quot;exceptionMapper&quot; class=&quot;com.upmc.tdc.exception.ExceptionMapper&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;     &amp;lt;bean id=&quot;jaxbProvider&quot; class=&quot;org.apache.cxf.jaxrs.provider.JAXBElementProvider&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;marshallerProperties&quot; ref=&quot;propertiesMap&quot; /&amp;gt;&lt;br/&gt;
         &amp;lt;property name=&quot;namespacePrefixes&quot; ref=&quot;namespaceMap&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;enableBuffering&quot; value=&quot;true&quot; /&amp;gt;&lt;br/&gt;
    &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;     &amp;lt;util:map id=&quot;propertiesMap&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;entry key=&quot;jaxb.formatted.output&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;value type=&quot;java.lang.Boolean&quot;&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
            &amp;lt;!--  prints indented XML for REST, useful for testing, can be disabled for production --&amp;gt;&lt;br/&gt;
        &amp;lt;/entry&amp;gt;&lt;br/&gt;
    &amp;lt;/util:map&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;util:map id=&quot;namespaceMap&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;entry key=&quot;http://server.tdc.upmc.com/&quot;  value=&quot;GoldenKey&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/util:map&amp;gt;&lt;/p&gt;

&lt;p&gt;This setup throws the following exception:&lt;/p&gt;

&lt;p&gt;java.lang.UnsupportedOperationException&lt;br/&gt;
    at java.util.AbstractMap.put(AbstractMap.java:203)&lt;br/&gt;
    at java.util.AbstractMap.putAll(AbstractMap.java:273)&lt;br/&gt;
    at org.apache.cxf.jaxrs.provider.JAXBElementProvider.marshalCollectionMember(JAXBElementProvider.java:327)&lt;br/&gt;
    at org.apache.cxf.jaxrs.provider.JAXBElementProvider.marshalCollection(JAXBElementProvider.java:293)&lt;br/&gt;
    at org.apache.cxf.jaxrs.provider.JAXBElementProvider.writeTo(JAXBElementProvider.java:232)&lt;br/&gt;
    at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.serializeMessage(JAXRSOutInterceptor.java:257)&lt;br/&gt;
    at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.processResponse(JAXRSOutInterceptor.java:144)&lt;br/&gt;
    at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.handleMessage(JAXRSOutInterceptor.java:83)&lt;br/&gt;
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:263)&lt;br/&gt;
&amp;lt;clipped&amp;gt;&lt;/p&gt;

&lt;p&gt;Lines 325-330 of JAXBElementProvider.java contain the following code:&lt;br/&gt;
        if (ns.length() &amp;gt; 0) &lt;/p&gt;
{
            Map&amp;lt;String, String&amp;gt; map = Collections.singletonMap(ns, &quot;ns1&quot;);
            map.putAll(nsPrefixes);
            setNamespaceMapper(ms, map);
        }
&lt;p&gt;        marshal(obj, cls, genericType, enc, os, mt, ms);&lt;/p&gt;

&lt;p&gt;The call Collections.singletonMap(...) is below:&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Returns an immutable map, mapping only the specified key to the&lt;/li&gt;
	&lt;li&gt;specified value.  The returned map is serializable.&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@param key the sole key to be stored in the returned map.&lt;/li&gt;
	&lt;li&gt;@param value the value to which the returned map maps &amp;lt;tt&amp;gt;key&amp;lt;/tt&amp;gt;.&lt;/li&gt;
	&lt;li&gt;@return an immutable map containing only the specified key-value&lt;/li&gt;
	&lt;li&gt;mapping.&lt;/li&gt;
	&lt;li&gt;@since 1.3&lt;br/&gt;
     */&lt;br/&gt;
    public static &amp;lt;K,V&amp;gt; Map&amp;lt;K,V&amp;gt; singletonMap(K key, V value) 
{
        return new SingletonMap&amp;lt;&amp;gt;(key, value);
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So it seems that&lt;br/&gt;
            map.putAll(nsPrefixes);&lt;/p&gt;

&lt;p&gt;should fail as it is failing when called because the map is immutable.&lt;/p&gt;

&lt;p&gt;In case there are other prefixes to add it seems that the map should be of another type....&lt;/p&gt;</description>
                <environment></environment>
        <key id="12533472">CXF-3946</key>
            <summary>&lt;property name=&quot;namespacePrefixes&quot; ref=&quot;namespaceMap&quot; /&gt; causes exception due to immutable Map being used in JAXBElementProvider</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="jrfeitosamm">Miguel Martins Feitosa Jr.</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2011 16:17:57 +0000</created>
                <updated>Mon, 19 Dec 2011 16:15:06 +0000</updated>
                            <resolved>Fri, 2 Dec 2011 22:40:31 +0000</resolved>
                                    <version>2.5</version>
                                    <fixVersion>2.4.5</fixVersion>
                    <fixVersion>2.5.1</fixVersion>
                                    <component>JAX-RS</component>
                    <component>JAXB Databinding</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219200</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b8mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>