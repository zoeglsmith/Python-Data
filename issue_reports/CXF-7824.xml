<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:43:12 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7824] CacheMap may have spurious null keys</title>
                <link>https://issues.apache.org/jira/browse/CXF-7824</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I was debugging a bug in my code and by accident I found a bug in CacheMap.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The function updateMainDataMap copies elements from extraKeyMap to mainDataMap but does not make sure that keys are not null.&lt;/p&gt;

&lt;p&gt;It is possible that entrySet of WeakIdentityHashMap will return null keys.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Set&amp;lt;Map.Entry&amp;lt;K, V&amp;gt;&amp;gt; entrySet() {
    reap();
    Set&amp;lt;Map.Entry&amp;lt;K, V&amp;gt;&amp;gt; ret = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;Map.Entry&amp;lt;K, V&amp;gt;&amp;gt;();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;IdentityWeakReference, V&amp;gt; ref : backingStore.entrySet()) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; K key = ref.getKey().get(); &lt;span class=&quot;code-comment&quot;&gt;//possible &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; here
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; V value = ref.getValue();
        Map.Entry&amp;lt;K, V&amp;gt; entry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Map.Entry&amp;lt;K, V&amp;gt;() {
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; K getKey() {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; key;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; V getValue() {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; V setValue(V value) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnsupportedOperationException();
            }
        };
        ret.add(entry);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Collections.unmodifiableSet(ret);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On entrance the function clears all null keys (in the reap() functon) and then iterates over backingStore. But it is possible that after reap() a key is garbage collected and its WeakReference will return null (ref.getKey().get()).&lt;/p&gt;

&lt;p&gt;This causes a spurious null key.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I gave this case a Major priority because this class is used by WSDLManagerImpl, and spurious null keys cause serious problems there. I can reproduce this problem in a few minutes of testing. The testcase consists of creating generated service over and over again by multiple threads. Unfortunately the testcase itself is too big to share.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13180440">CXF-7824</key>
            <summary>CacheMap may have spurious null keys</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deki">Dennis Kieselhorst</assignee>
                                    <reporter username="pachum">Micha&#322; Pachucki</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Aug 2018 10:41:31 +0000</created>
                <updated>Tue, 11 Dec 2018 17:12:35 +0000</updated>
                            <resolved>Thu, 30 Aug 2018 10:32:17 +0000</resolved>
                                    <version>3.2.6</version>
                                    <fixVersion>3.2.7</fixVersion>
                    <fixVersion>3.1.18</fixVersion>
                    <fixVersion>3.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16589885" author="deki" created="Thu, 23 Aug 2018 08:11:22 +0000"  >&lt;p&gt;Thanks for the bug report. Can you propose a fix as a pull request via &lt;a href=&quot;https://github.com/apache/cxf/pulls?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pulls?&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16593473" author="pachum" created="Mon, 27 Aug 2018 10:50:36 +0000"  >&lt;p&gt;I can try, but at work I have cloning from github blocked due to some reason and a newborn at home &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="16597280" author="deki" created="Thu, 30 Aug 2018 10:10:42 +0000"  >&lt;p&gt;Is it enough to add a null check in entrySet and keySet? Or what kind of fix would you propose?&lt;/p&gt;</comment>
                            <comment id="16597284" author="pachum" created="Thu, 30 Aug 2018 10:12:26 +0000"  >&lt;p&gt;I think it is enough.&lt;/p&gt;</comment>
                            <comment id="16597300" author="deki" created="Thu, 30 Aug 2018 10:32:17 +0000"  >&lt;p&gt;Ok done: &lt;a href=&quot;https://github.com/apache/cxf/commit/88c493bd64ceb68f24301b50c6e795f47526c566&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/commit/88c493bd64ceb68f24301b50c6e795f47526c566&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please retest with the latest SNAPSHOT version.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13009575">CXF-7076</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xavj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>