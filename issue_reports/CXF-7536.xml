<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:42:56 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7536] STRTransform TransformException when manually adding SAML Assertion via SAMLCallback.setAssertionElement()</title>
                <link>https://issues.apache.org/jira/browse/CXF-7536</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;In Apache CXF v3.1.7, I have a JAX-WS web service client calling a service that requires a HolderOfKey SAML Assertion. The assertions are from a custom service that does not adhere to the WS-Trust SecureTokenService standard, so I am adding them manually in a SAMLCallbackHander, using the callback.setAssertionElement() method.&lt;/p&gt;

&lt;p&gt;When invoking the client, the WSS4J framework is unable to compute the signature for the SecurityTokenReference header block, throwing the below error:&lt;/p&gt;

&lt;p&gt;{{&lt;br/&gt;
javax.xml.crypto.dsig.XMLSignatureException: javax.xml.crypto.dsig.TransformException: org.apache.wss4j.common.ext.WSSecurityException: Referenced token &quot;id-of-SAML-assertion&quot; not found&lt;br/&gt;
at org.apache.wss4j.dom.str.STRParserUtil.getTokenElement(StrParserUtil.java:314)&lt;br/&gt;
at org.apache.wss4j.dom.transform.STRTransformUtil.dereferenceSTR(STRTransformUtil.java:98)&lt;br/&gt;
at org.apache.wss4j.dom.transform.STRTransform.transformIt(STRTransform.java:195)}}&lt;/p&gt;

&lt;p&gt;It appears that the SAML assertion DOM Element that is added via the callback.setAssertionElement() method is not getting searched by the STRParserUtil.getTokenElement() method.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Apache Tomcat 8.0.37&lt;/p&gt;</environment>
        <key id="13110036">CXF-7536</key>
            <summary>STRTransform TransformException when manually adding SAML Assertion via SAMLCallback.setAssertionElement()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="rorf">Russell Orf</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Tue, 17 Oct 2017 16:48:30 +0000</created>
                <updated>Tue, 28 Nov 2017 10:51:29 +0000</updated>
                            <resolved>Mon, 23 Oct 2017 14:50:26 +0000</resolved>
                                                    <fixVersion>3.1.14</fixVersion>
                    <fixVersion>3.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16209145" author="coheigea" created="Wed, 18 Oct 2017 10:53:59 +0000"  >&lt;p&gt;I need more information on the scenario to reproduce the problem. Are you using WS-SecurityPolicy or configuring WSS4J manually? If the former, could you list the security policy here? If the latter, please attach the security configuration.&lt;/p&gt;</comment>
                            <comment id="16209160" author="rorf" created="Wed, 18 Oct 2017 11:18:49 +0000"  >&lt;p&gt;We are using WS-SecurityPolicy. There are two policies applied to our service endpoint:&lt;/p&gt;

&lt;p&gt;&amp;lt;wsp:Policy xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2004/09/policy&quot; xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot; xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot; wsu:Id=&quot;endpoint_HolderOfKey&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
    &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
      &amp;lt;sp:AsymmetricBinding&amp;gt;&lt;br/&gt;
        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
          &amp;lt;sp:InitiatorToken&amp;gt;&lt;br/&gt;
            &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
              &amp;lt;sp:SamlToken sp:IncludeToken=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/AlwaysToRecipient&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                  &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                    &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
                      &amp;lt;sp:WssSamlV11Token10/&amp;gt;&lt;br/&gt;
                    &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
                    &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
                      &amp;lt;sp:WssSamlV11Token11/&amp;gt;&lt;br/&gt;
                    &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
                  &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
              &amp;lt;/sp:SamlToken&amp;gt;&lt;br/&gt;
            &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
          &amp;lt;/sp:InitiatorToken&amp;gt;&lt;br/&gt;
          &amp;lt;sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
            &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
              &amp;lt;sp:Basic256/&amp;gt;&lt;br/&gt;
              &amp;lt;sp:STRTransform10/&amp;gt;&lt;br/&gt;
            &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
          &amp;lt;/sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
          &amp;lt;sp:Layout&amp;gt;&lt;br/&gt;
            &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
              &amp;lt;sp:Lax/&amp;gt;&lt;br/&gt;
            &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
          &amp;lt;/sp:Layout&amp;gt;&lt;br/&gt;
          &amp;lt;sp:IncludeTimestamp/&amp;gt;&lt;br/&gt;
          &amp;lt;sp:ProtectTokens/&amp;gt;&lt;br/&gt;
          &amp;lt;sp:OnlySignEntireHeadersAndBody/&amp;gt;&lt;br/&gt;
        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
      &amp;lt;/sp:AsymmetricBinding&amp;gt;&lt;br/&gt;
      &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
        &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
          &amp;lt;sp:SignedSupportingTokens&amp;gt;&lt;br/&gt;
            &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
              &amp;lt;sp:X509Token sp:IncludeToken=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/AlwaysToRecipient&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                  &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                    &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
                      &amp;lt;sp:WssX509V3Token10/&amp;gt;&lt;br/&gt;
                    &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
                    &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
                      &amp;lt;sp:WssX509V3Token11/&amp;gt;&lt;br/&gt;
                    &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
                  &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
              &amp;lt;/sp:X509Token&amp;gt;&lt;br/&gt;
            &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
          &amp;lt;/sp:SignedSupportingTokens&amp;gt;&lt;br/&gt;
        &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
      &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
    &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
  &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;/p&gt;


&lt;p&gt;&amp;lt;wsp:Policy xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot; xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot; xmlns:wsse11=&quot;http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd&quot; xmlns:env11=&quot;http://schemas.xmlsoap.org/soap/envelope&quot; xmlns:env12=&quot;http://www.w3.org/2003/05/soap-envelope&quot; xmlns:saml=&quot;urn:oasis:names:tc:SAML:1.0:assertion&quot; xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot; xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2004/09/policy&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;sp:SignedParts&amp;gt;&lt;br/&gt;
    &amp;lt;sp:Body/&amp;gt;&lt;br/&gt;
  &amp;lt;/sp:SignedParts&amp;gt;&lt;br/&gt;
  &amp;lt;sp:SignedElements&amp;gt;&lt;br/&gt;
    &amp;lt;sp:XPath&amp;gt;&lt;br/&gt;
      /env11:Header/wsse:Security/wsu:Timestamp&lt;br/&gt;
    &amp;lt;/sp:XPath&amp;gt;&lt;br/&gt;
    &amp;lt;sp:XPath&amp;gt;&lt;br/&gt;
     /env11:Header/wsse:Security/wsse:BinarySecurityToken&lt;br/&gt;
    &amp;lt;/sp:XPath&amp;gt;&lt;br/&gt;
    &amp;lt;sp:XPath&amp;gt;&lt;br/&gt;
     /env11:Header/wsse:Security/saml:Assertion&lt;br/&gt;
    &amp;lt;/sp:XPath&amp;gt;&lt;br/&gt;
  &amp;lt;/sp:SignedElements&amp;gt;&lt;br/&gt;
  &amp;lt;sp:SignedElements&amp;gt;&lt;br/&gt;
    &amp;lt;sp:XPath&amp;gt;&lt;br/&gt;
      /env12:Header/wsse:Security/wsu:Timestamp&lt;br/&gt;
    &amp;lt;/sp:XPath&amp;gt;&lt;br/&gt;
    &amp;lt;sp:XPath&amp;gt;&lt;br/&gt;
     /env12:Header/wsse:Security/wsse:BinarySecurityToken&lt;br/&gt;
    &amp;lt;/sp:XPath&amp;gt;&lt;br/&gt;
    &amp;lt;sp:XPath&amp;gt;&lt;br/&gt;
     /env12:Header/wsse:Security/saml:Assertion&lt;br/&gt;
    &amp;lt;/sp:XPath&amp;gt;&lt;br/&gt;
  &amp;lt;/sp:SignedElements&amp;gt;&lt;br/&gt;
  &amp;lt;sp:RequiredElements&amp;gt;&lt;br/&gt;
    &amp;lt;sp:XPath&amp;gt;wsse:Security/wsu:Timestamp&amp;lt;/sp:XPath&amp;gt;&lt;br/&gt;
  &amp;lt;/sp:RequiredElements&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;/p&gt;

&lt;p&gt;Note: On deployment of our service client to tomcat, we see the WARNING: org.apache.cxf.ws.policy.AssertionBuilderRegistryImpl.handleNoRegisteredBuilder No assertion builder for type &lt;/p&gt;
{http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/}
&lt;p&gt;STRTransform10 registered.&lt;/p&gt;</comment>
                            <comment id="16209488" author="coheigea" created="Wed, 18 Oct 2017 15:02:57 +0000"  >&lt;p&gt;I can&apos;t reproduce this issue. I suggest trying with a more recent version of CXF (3.1.13 is released). If you can still reproduce it then please submit a test-case that reproduces the issue.&lt;/p&gt;</comment>
                            <comment id="16209509" author="rorf" created="Wed, 18 Oct 2017 15:11:21 +0000"  >&lt;p&gt;I&apos;ve updated the policy on the web service client to force the generation of the SecurityTokenReference block in the request. Please try this:&lt;/p&gt;

&lt;p&gt;&amp;lt;wsp:Policy xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2004/09/policy&quot; xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot; xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot; wsu:Id=&quot;endpoint_HolderOfKey&quot;&amp;gt;&lt;br/&gt;
&amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;sp:AsymmetricBinding&amp;gt;&lt;br/&gt;
&amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;sp:InitiatorToken&amp;gt;&lt;br/&gt;
&amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;sp:SamlToken sp:IncludeToken=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/AlwaysToRecipient&quot;&amp;gt;&lt;br/&gt;
&amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;sp:WssSamlV11Token10/&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;sp:WssSamlV11Token11/&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;/sp:SamlToken&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;/sp:InitiatorToken&amp;gt;&lt;br/&gt;
&amp;lt;sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
&amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;sp:Basic256/&amp;gt;&lt;br/&gt;
&amp;lt;sp:STRTransform10/&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;/sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
&amp;lt;sp:Layout&amp;gt;&lt;br/&gt;
&amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;sp:Lax/&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;/sp:Layout&amp;gt;&lt;br/&gt;
&amp;lt;sp:IncludeTimestamp/&amp;gt;&lt;br/&gt;
&amp;lt;sp:ProtectTokens/&amp;gt;&lt;br/&gt;
&amp;lt;sp:OnlySignEntireHeadersAndBody/&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;/sp:AsymmetricBinding&amp;gt;&lt;br/&gt;
&amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;sp:SignedSupportingTokens&amp;gt;&lt;br/&gt;
&amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;sp:SamlToken sp:IncludeToken=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/AlwaysToRecipient&quot;&amp;gt;&lt;br/&gt;
&amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;sp:WssSamlV11Token10/&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;sp:WssSamlV11Token11/&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;/sp:SamlToken&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
&amp;lt;/sp:SignedSupportingTokens&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
&amp;lt;/wsp:Policy&amp;gt;&lt;/p&gt;</comment>
                            <comment id="16209585" author="coheigea" created="Wed, 18 Oct 2017 16:01:33 +0000"  >&lt;p&gt;Is STRTransform10 supported by CXF? I don&apos;t think it is...&lt;/p&gt;</comment>
                            <comment id="16209651" author="rorf" created="Wed, 18 Oct 2017 16:27:39 +0000"  >&lt;p&gt;I&apos;m not sure where to check that it&apos;s supported or not. I see this WARNING below when deploying my client to tomcat:&lt;/p&gt;

&lt;p&gt;{{&lt;br/&gt;
WARNING: org.apache.cxf.ws.policy.AssertionBuilderRegistryImpl.handleNoRegisteredBuilder No assertion builder for type&lt;br/&gt;
&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/&lt;/a&gt; STRTransform10 registered.}}&lt;/p&gt;

&lt;p&gt;Is there a way to add that support in a configuration file? What are the other options?&lt;/p&gt;</comment>
                            <comment id="16209697" author="coheigea" created="Wed, 18 Oct 2017 17:13:00 +0000"  >&lt;p&gt;It probably doesn&apos;t really matter. Can you try adapting a CXF system test or something to reproduce the error you are seeing?&lt;/p&gt;</comment>
                            <comment id="16209704" author="rorf" created="Wed, 18 Oct 2017 17:20:24 +0000"  >&lt;p&gt;Yes, I will work on that.&lt;/p&gt;</comment>
                            <comment id="16211684" author="rorf" created="Thu, 19 Oct 2017 20:31:13 +0000"  >&lt;p&gt;I have reproduced the issue using Tomcat v8.5 (out of the box configuration) and CXF v3.1.13. The steps to reproduce are:&lt;/p&gt;

&lt;p&gt;1) Start Tomcat. &lt;br/&gt;
2) Deploy the .war file. It has a servlet context listener that will attempt to make the service call on servlet initialization.&lt;/p&gt;

&lt;p&gt;I have attached the tomcat log from my test and the .war file deployed. The source is available here: &lt;a href=&quot;https://github.com/russellorf/service-client&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/russellorf/service-client&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please let me know if there&apos;s anything else you need.&lt;/p&gt;
</comment>
                            <comment id="16212382" author="coheigea" created="Fri, 20 Oct 2017 08:54:48 +0000"  >&lt;p&gt;Thanks for the test-case. The problem is that your security policy references a SAML Token both as the InitiatorToken for the AsymmetricBinding + then again as the SignedSupportingToken. It attempts to add the same SAML Token twice and throws an error as both tokens have the same ID. I think for this case you don&apos;t need the SignedSupportingToken policy.&lt;/p&gt;</comment>
                            <comment id="16214942" author="rorf" created="Mon, 23 Oct 2017 10:36:55 +0000"  >&lt;p&gt;Omitting the SignedSupportingToken block from the policy does eliminate the error, however the request generated does not contain the wsse:SecurityTokenReference block as required by the service. Specifically, I need the request header to look like the below. How can I configure the policy to generate the SecurityTokenReference block?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;env:Header&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsse:Security&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;saml:Assertion assertionID=&lt;span class=&quot;code-quote&quot;&gt;&quot;myassertionid&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      ...
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/saml:Assertion&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- THIS BLOCK IS MISSING --&amp;gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsse:SecurityTokenReference wsu:Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;SAMLStringId&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt; 
       &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsse:KeyIdentifier&amp;gt;&lt;/span&gt;myassertionid&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:KeyIdentifier&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:SecurityTokenReference&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:Signature&amp;gt;&lt;/span&gt;
       &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:SignedInfo&amp;gt;&lt;/span&gt;
        ...
       &lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- THIS BLOCK IS MISSING --&amp;gt;&lt;/span&gt;&lt;/span&gt;
       &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#SAMLStringId&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:Transforms&amp;gt;&lt;/span&gt;
           &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#STRTransform&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
             &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsse:TransformationParameters &lt;span class=&quot;code-keyword&quot;&gt;xmlns:wsse&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-security-secext-1.0.xsd&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
               &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:CanonicalizationMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
             &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:TransformationParameters&amp;gt;&lt;/span&gt;
           &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:Transform&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:Transforms&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:DigestValue&amp;gt;&lt;/span&gt;ADALEI;RGLADKJA&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:DigestValue&amp;gt;&lt;/span&gt;
       &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:Reference&amp;gt;&lt;/span&gt;
        ...
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:SignedInfo&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:SignatureValue&amp;gt;&lt;/span&gt;aldka;slasdlfkajei&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:SignatureValue&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dsig:KeyInfo&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsse:SecurityTokenReference&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsse:KeyIdentifier&amp;gt;&lt;/span&gt;myassertionid&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:KeyIdentifier&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:SecurityTokenReference&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:KeyInfo&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dsig:Signature&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:Security&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/env:Header&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16215236" author="coheigea" created="Mon, 23 Oct 2017 14:46:00 +0000"  >&lt;p&gt;OK I have moved this JIRA to CXF as it is a CXF issue, not WSS4J. I&apos;ve done the fix so it will be available in the next round of releases. BTW your XPath expressions above are not correct, and will not work, as they are missing the &quot;Envelope&quot; at the start (e.g. should be &quot;/env11:Envelope/env11:Header/wsse:Security/saml:Assertion&quot; and not &quot;/env11:Header/wsse:Security/saml:Assertion&quot;).&lt;/p&gt;</comment>
                            <comment id="16215294" author="rorf" created="Mon, 23 Oct 2017 15:23:24 +0000"  >&lt;p&gt;Ok. What is the fix you&apos;re describing? What policy do I need to use for the SRT to be generated as above? When will the next round of releases be available?&lt;/p&gt;

&lt;p&gt;I will update the XPath expressions to include the Envelope.&lt;/p&gt;</comment>
                            <comment id="16215299" author="coheigea" created="Mon, 23 Oct 2017 15:26:27 +0000"  >&lt;p&gt;With the fix, you should be able to leave out the SignedSupportingToken policy element, and the XPath expression will sign the SAML InitiatorToken correctly using a STR Transform. The next set of releases will be available probably in 3/4 weeks.&lt;/p&gt;</comment>
                            <comment id="16216671" author="rorf" created="Tue, 24 Oct 2017 10:27:03 +0000"  >&lt;p&gt;Can you confirm that the fix will also include a SecurityTokenReference block with KeyIdentifier in the Security Header, as I described in an earlier post?&lt;/p&gt;

&lt;p&gt;Can you confirm the next set of releases will be v3.2.1 and v3.1.14?&lt;/p&gt;</comment>
                            <comment id="16218266" author="coheigea" created="Wed, 25 Oct 2017 08:59:48 +0000"  >&lt;p&gt;The fix will be in 3.1.14, 3.2.1 - which are the next set of releases, yes. Please grab the latest SNAPSHOT version of either CXF 3.1.14-SNAPSHOT or 3.2.1-SNAPSHOT and check that it is working correctly for you. &lt;/p&gt;</comment>
                            <comment id="16219810" author="rorf" created="Thu, 26 Oct 2017 01:12:33 +0000"  >&lt;p&gt;I&apos;ve tried out the fix, and it&apos;s not working for me. The SOAP message is getting constructed, however the wsse:SecurityTokenReference block, and it&apos;s signature reference, are not present in the request. I&apos;ve pushed my changes here that tried it out, including the generated SOAP message:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/russellorf/service-client/commit/c4a90a487ed832db228edcc635ee52e652021179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/russellorf/service-client/commit/c4a90a487ed832db228edcc635ee52e652021179&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please let me know if you&apos;d like me to attach the .war file.&lt;/p&gt;</comment>
                            <comment id="16220461" author="coheigea" created="Thu, 26 Oct 2017 14:01:46 +0000"  >&lt;p&gt;I got it working with 2 changes to &quot;Endpoint_GenericInput.xml&quot;:&lt;/p&gt;

&lt;p&gt;a) Add a trailing forward slash to the xmlns:env11 namespace definition&lt;br/&gt;
b) Add a &amp;lt;wsp:ExactlyOne&amp;gt;&amp;lt;wsp:All&amp;gt; wrapper around the policies in this file&lt;/p&gt;</comment>
                            <comment id="16220993" author="rorf" created="Thu, 26 Oct 2017 18:43:23 +0000"  >&lt;p&gt;I&apos;ve tried updating the policy file as you&apos;ve described, however the behavior I see is the same. I&apos;ve pushed the changes that I tried, including the generated SOAP message:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/russellorf/service-client/commit/a106cc0539eee62fde361e30e0a84250e54c2f38&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/russellorf/service-client/commit/a106cc0539eee62fde361e30e0a84250e54c2f38&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="16222475" author="coheigea" created="Fri, 27 Oct 2017 14:42:39 +0000"  >&lt;p&gt;The problem is that you have two SignedElements policy specified as an alternative, so it will only select one (randomly). Instead just have all of your XPath expressions in one SignedElement policy and it should work.&lt;/p&gt;</comment>
                            <comment id="16234054" author="rorf" created="Wed, 1 Nov 2017 13:20:25 +0000"  >&lt;p&gt;I have confirmed that the header security blocks now reflect the desired format. This appears to be fixed for the client side.&lt;/p&gt;

&lt;p&gt;An unrelated issue: I&apos;m trying to generate the Java binding classes using wsdl2java for a SwA WSDL and getting errors. I see this issue has been reported in the past (&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-284&quot; title=&quot;Support SOAP with Attachments in Runtime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-284&quot;&gt;&lt;del&gt;CXF-284&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-1352&quot; title=&quot;SOAP with Attachments is not working or cannot get to work !?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-1352&quot;&gt;&lt;del&gt;CXF-1352&lt;/del&gt;&lt;/a&gt;) and is labelled &quot;Fixed&quot;, however a comment notes &quot;this SwA wsdl is not supported by CXF&quot;. Are SwA WSDLs supported by CXF? How can I generate the Java bindings for a SwA WSDL using CXF?&lt;/p&gt;

&lt;p&gt;I don&apos;t see a SwA WSDL listed under the MTOM w/ SwA sample:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/tree/master/distribution/src/main/release/samples/mtom&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/tree/master/distribution/src/main/release/samples/mtom&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16235754" author="rorf" created="Thu, 2 Nov 2017 13:47:50 +0000"  >&lt;p&gt;Hi, did you see my response?&lt;/p&gt;</comment>
                            <comment id="16235884" author="coheigea" created="Thu, 2 Nov 2017 15:15:48 +0000"  >&lt;p&gt;Yes, but I don&apos;t know what the answer is. Maybe someone on the mailing list will know.&lt;/p&gt;</comment>
                            <comment id="16235885" author="coheigea" created="Thu, 2 Nov 2017 15:15:49 +0000"  >&lt;p&gt;Yes, but I don&apos;t know what the answer is. Maybe someone on the mailing list will know.&lt;/p&gt;</comment>
                            <comment id="16240229" author="rorf" created="Mon, 6 Nov 2017 12:49:52 +0000"  >&lt;p&gt;Ok; Email sent to issues@cxf.apache.org. I hope that is the correct list. (also tried users@cxf.apache.org)&lt;/p&gt;</comment>
                            <comment id="16240233" author="coheigea" created="Mon, 6 Nov 2017 12:52:14 +0000"  >&lt;p&gt;users@cxf is the correct list.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12893109" name="catalina.out" size="4321923" author="rorf" created="Thu, 19 Oct 2017 20:30:30 +0000"/>
                            <attachment id="12893108" name="service-client.war" size="29927802" author="rorf" created="Thu, 19 Oct 2017 20:30:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ld7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>