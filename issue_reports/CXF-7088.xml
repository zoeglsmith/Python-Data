<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:48:02 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7088] SignedEncryptedSupportingTokens in WS-Policy and SAML not encrypted being accepted</title>
                <link>https://issues.apache.org/jira/browse/CXF-7088</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;In WS-Policy that is used by service we have defined &lt;/p&gt;

&lt;p&gt;&amp;lt;SignedEncryptedSupportingTokens/&amp;gt;&lt;/p&gt;

&lt;p&gt;Some people say that WS-SecurityPolicy 1.2 imply that also SAML assertion that is inside WS-Security section of the message SOAP Header should be encrypted (not only signed).&lt;/p&gt;

&lt;p&gt;Message with SAML that is NOT encrypted is currently accepted by CXF even while policy defines &amp;lt;SignedEncryptedSupportingTokens/&amp;gt;&lt;/p&gt;

&lt;p&gt;Question is: does SAML assertion fall into &quot;SupportingTokens&quot; category and should be encrypted as well?&lt;/p&gt;

&lt;p&gt;What is your view on that? Is that a bug in Neethi?&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/ws-securitypolicy-1.2-spec-os.html#_Toc161826566&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/ws-securitypolicy-1.2-spec-os.html#_Toc161826566&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Signed, encrypted supporting tokens are Signed supporting tokens (See section 8.2) that are also encrypted when they appear in the wsse:SecurityHeader. Element Encryption SHOULD be used for encrypting the supporting tokens.&lt;br/&gt;
The syntax for the sp:SignedEncryptedSupportingTokens differs from the syntax of sp:SignedSupportingTokens only in the name of the assertion itself. All nested policy is as per the sp:SignedSupportingTokens assertion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13011933">CXF-7088</key>
            <summary>SignedEncryptedSupportingTokens in WS-Policy and SAML not encrypted being accepted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="gmaczuga">Grzegorz Maczuga</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Oct 2016 09:04:07 +0000</created>
                <updated>Fri, 21 Oct 2016 18:45:39 +0000</updated>
                            <resolved>Fri, 14 Oct 2016 17:26:24 +0000</resolved>
                                    <version>3.0.6</version>
                                    <fixVersion>3.1.8</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15571643" author="coheigea" created="Thu, 13 Oct 2016 11:26:00 +0000"  >&lt;p&gt;Could you supply the security policy that you are using as well as a sample of the message that should be failing (but isn&apos;t)? I tried with CXF 3.0.6 with an unencrypted SAML Assertion and it fails as expected with:&lt;/p&gt;

&lt;p&gt;javax.xml.ws.soap.SOAPFaultException: These policy alternatives can not be satisfied:&lt;/p&gt;
{http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}
&lt;p&gt;SignedEncryptedSupportingTokens: The received token does not match the signed encrypted supporting token requirement&lt;/p&gt;</comment>
                            <comment id="15571819" author="gmaczuga" created="Thu, 13 Oct 2016 12:47:07 +0000"  >&lt;p&gt;SOAP Message (anonymized due to our project requirements)&lt;br/&gt;
and Policy attached.&lt;/p&gt;</comment>
                            <comment id="15571894" author="coheigea" created="Thu, 13 Oct 2016 13:22:01 +0000"  >&lt;p&gt;What is the EncryptedData structure below the Assertion? Is it possible that your client is including both the SAML Assertion as well as an encrypted version of it?&lt;/p&gt;

&lt;p&gt;I tried using the exact same policy with CXF tests, where the client uses SignedSupportingToken only, and the service correctly rejects the request. My guess is that the Assertion is being encrypted in your request and hence there is no failure.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="15572015" author="gmaczuga" created="Thu, 13 Oct 2016 14:03:40 +0000"  >&lt;p&gt;That is highly possible! Please close it.&lt;br/&gt;
Thanks Colm.&lt;/p&gt;

&lt;p&gt;Greg&lt;/p&gt;</comment>
                            <comment id="15575313" author="gmaczuga" created="Fri, 14 Oct 2016 13:21:02 +0000"  >&lt;p&gt;Hi Colm,&lt;/p&gt;

&lt;p&gt;Actually we turn off Encryption completely to see that sent request contains just extra UsernameToken.&lt;/p&gt;

&lt;p&gt;In such case such request is processed by CXF - with SAML Assertion being only signed, not encrypted as required by WS-Policy. &lt;/p&gt;

&lt;p&gt;See file attached.&lt;/p&gt;</comment>
                            <comment id="15575404" author="coheigea" created="Fri, 14 Oct 2016 13:54:00 +0000"  >&lt;p&gt;Where is the encrypted UsernameToken coming from? It&apos;s not in the policy and shouldn&apos;t be in the request. I tried to hack up a CXF test to send an encrypted UsernameToken with an unencrypted SAML token but it failed as expected. At this point I think you need to supply some kind of test that shows the failure. You could try adapting one of the ws-security systests in the git repo.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="15575434" author="gmaczuga" created="Fri, 14 Oct 2016 14:04:32 +0000"  >&lt;p&gt;Message is generated on Oracle Api Gateway (so you can put in the message whatever you want) and received by CXF.&lt;br/&gt;
It is just the proof that what was previously encrypted in message sample is not SAML Assertion (as you suspected) but Username Token.&lt;br/&gt;
Thus still we have not-encrypted SAML Assertion that is processed by CXF with SignedEncryptedSupportingTokens wrapping SAML Assertion in binding policy. &lt;br/&gt;
Moreover as you pointed out - there is Username Token which is not in policy and shouldn&apos;t be there (but it is and I expect to be just ignored)?&lt;/p&gt;

&lt;p&gt;We will remove Username Token and see what happen then.&lt;/p&gt;</comment>
                            <comment id="15575483" author="coheigea" created="Fri, 14 Oct 2016 14:20:58 +0000"  >&lt;p&gt;Is the message received over TLS by any chance? If so this counts as &quot;encrypted&quot;.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="15575504" author="gmaczuga" created="Fri, 14 Oct 2016 14:27:50 +0000"  >&lt;p&gt;Yes it is - 2-way TLS.&lt;br/&gt;
Is that mentioned somewhere in WS-Policy or WS-SecurityPolicy standard&apos;s?&lt;/p&gt;</comment>
                            <comment id="15575527" author="coheigea" created="Fri, 14 Oct 2016 14:36:22 +0000"  >&lt;p&gt;It looks like this is a bug in CXF. From the spec for EncryptedParts:&lt;/p&gt;

&lt;p&gt;The EncryptedParts assertion is used to specify the parts of the message that require confidentiality. This&lt;br/&gt;
assertion can be satisfied with WSS: SOAP Message Security mechanisms or by mechanisms out of&lt;br/&gt;
scope of SOAP message security, for example by sending the message over a secure transport protocol&lt;br/&gt;
like HTTPS.&lt;/p&gt;

&lt;p&gt;This is the logic CXF follows. However, for the tokens it appears like the tokens themselves should be encrypted instead.&lt;/p&gt;</comment>
                            <comment id="15575740" author="coheigea" created="Fri, 14 Oct 2016 16:10:06 +0000"  >&lt;p&gt;Ok I&apos;m going to fix this by requiring that an EncryptedToken is encrypted at the message level unless a TransportBinding is explicitly used.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12833369" name="messageNoEncryption.txt" size="8424" author="gmaczuga" created="Fri, 14 Oct 2016 13:21:26 +0000"/>
                            <attachment id="12833108" name="message_anonymous.txt" size="25283" author="gmaczuga" created="Thu, 13 Oct 2016 12:47:07 +0000"/>
                            <attachment id="12833109" name="policy.txt" size="3212" author="gmaczuga" created="Thu, 13 Oct 2016 12:47:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34tpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>