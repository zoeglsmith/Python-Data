<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat May 27 09:48:33 UTC 2023

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4154] AbstractConduitSelector reused cached conduit even if protocol was changed</title>
                <link>https://issues.apache.org/jira/browse/CXF-4154</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Actually AbstractConduitSelector.getSelectedConduit() creates and caches conduit in selectedConduit variable. Cached conduit is reused by the next calls.&lt;/p&gt;

&lt;p&gt;I see the following problem: if user changed protocol in URI between calls, AbstractConduitSelector still uses cached Conduit even it cannot process new URL. In my case cached HTTP consuit tries to process UDP URL.&lt;/p&gt;

&lt;p&gt;Proposal for fix: check if protocol in URL was changed and if yes, close and reset selectedConduit.&lt;/p&gt;

&lt;p&gt;Patch is attached.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andrei.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12544962">CXF-4154</key>
            <summary>AbstractConduitSelector reused cached conduit even if protocol was changed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="ashakirin">Andrei Shakirin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Mar 2012 16:58:40 +0000</created>
                <updated>Mon, 23 Apr 2012 16:45:16 +0000</updated>
                            <resolved>Mon, 26 Mar 2012 16:03:11 +0000</resolved>
                                                    <fixVersion>2.6</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13221051" author="ashakirin" created="Fri, 2 Mar 2012 16:59:31 +0000"  >&lt;p&gt;Patch&lt;/p&gt;</comment>
                            <comment id="13236944" author="dkulp" created="Fri, 23 Mar 2012 18:59:11 +0000"  >
&lt;p&gt;There is a threading problem with the proposal that I definitely need to think more about.  If two threads are making requests, one of which changes the protocol, it can close the conduit used by the other thread prematurely.&lt;/p&gt;</comment>
                            <comment id="13237564" author="ashakirin" created="Sat, 24 Mar 2012 15:11:45 +0000"  >&lt;p&gt;Yep, you are right. Case is a little bit exotic, but anyway - patch is not safe. &lt;br/&gt;
I am going to fix it in the following way: provide a thread safe cache map for the conduits with protocol as key. In getSelectedConduit() check map first and create new conduit only if it is not cached for requested protocol. In close() release all conduits from the map. Patch will be improved soon.&lt;/p&gt;</comment>
                            <comment id="13237629" author="dkulp" created="Sat, 24 Mar 2012 18:48:37 +0000"  >&lt;p&gt;I&apos;m testing a different fix today.   Hopefully will commit on monday.&lt;/p&gt;</comment>
                            <comment id="13237823" author="ashakirin" created="Sun, 25 Mar 2012 10:34:27 +0000"  >&lt;p&gt;Ok, very curious to see how you fixed it.&lt;/p&gt;</comment>
                            <comment id="13238446" author="dkulp" created="Mon, 26 Mar 2012 14:47:59 +0000"  >&lt;p&gt;Committed a fix last night that pretty much removes the &quot;selectedConduit&quot; field and keeps a list of conduits.  Under normal operation, that&apos;s a single conduit, but it can &quot;grow&quot; as additional protocols and such require it.&lt;/p&gt;

&lt;p&gt;Because of the field removal, not back portable to &amp;lt;=2.5.x.   Will need to be release noted.&lt;/p&gt;

&lt;p&gt;Can you give it a quick spin to make sure it works OK?&lt;/p&gt;</comment>
                            <comment id="13238505" author="ashakirin" created="Mon, 26 Mar 2012 15:52:08 +0000"  >&lt;p&gt;Just tested with my use case - your fix works!&lt;/p&gt;

&lt;p&gt;Only snapshoot in findCompatibleConduit() I did not completely understand:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Conduit c2 : conduits) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c2.getTarget() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; 
                || c2.getTarget().getAddress() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                || c2.getTarget().getAddress().getValue() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; c2;
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Does conduit with not initialized target endpoint make sense at all? AbstractConduit constructor requires target endpoint argument, of course it is possible to give null there - but is there any use case for it? &lt;br/&gt;
Do you think it is legal to choose such conduit if there is no another one that fit better (regarding protocol or full URL)?&lt;br/&gt;
I would propose just return null in findCompatibleConduit() for this case and re-initialse conduit.&lt;/p&gt;</comment>
                            <comment id="13238515" author="dkulp" created="Mon, 26 Mar 2012 16:03:00 +0000"  >
&lt;p&gt;It is a valid use case.  Using the UpfrontConduitSelector, an application could configure in a conduit that &quot;protocol less&quot; or similar that is not specific to a target.   As an example, an ESB, instead of creating a conduit for each protocol, could just configure in a &quot;SuperDoEverythingConduit&quot; singleton or similar that is not target specific.   We do want to allow that type of thing.   (and there is a test that hits it which is why I added that check)  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Anyway, thanks for verifying that the fix works. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12516854" name="AbstractConduitSelector.patch" size="8731" author="ashakirin" created="Fri, 2 Mar 2012 16:59:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230148</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b6z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>